name: Auto Update README Date

on:
  workflow_dispatch:
  schedule:
    - cron: '0 16 * * *'

jobs:
  update-readme-date:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Update Date in README.md
        run: |
          CURRENT_DATE=$(TZ='Asia/Shanghai' date '+%Y/%m/%d')
          sed -i -E "s|(> \*\*更新日期\*\*： )[0-9]{4}/[0-9]{2}/[0-9]{2}|\1$CURRENT_DATE|" README.md
          echo "Date in README.md updated to $CURRENT_DATE"

      - name: Commit and push if changed
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'
          
          if [[ -n $(git status --porcelain README.md) ]]; then
            echo "Changes detected in README.md. Committing and pushing..."
            git add README.md
            git commit -m "docs: auto update readme date"
            git push
          else
            echo "No changes detected. Skipping commit."
          fi